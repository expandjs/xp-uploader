!function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){t.exports=s(1)},function(t,e,s){(function(e){const i="undefined"!=typeof window?window:e,n="undefined"!=typeof window?null:s(3),r="undefined"!=typeof window?null:s(4),a="undefined"!=typeof window?null:s(5),o="undefined"!=typeof window?{}:r.STATUS_CODES,h=i.location||{},d=i.XP||s(6),l=(i.XPBuffer||s(7),i.XPEmitter||s(8));t.exports=new d.Class("XPUploader",{extends:l,initialize:{promise:!0,value(t,e){l.call(this),d.isObject(t)||(t={url:t}),d.isFalsy(t.url)||Object.assign(t,d.pick(d.parseURL(t.url),["hostname","path","port","protocol"])),this.downLoaded=0,this.upLoaded=0,this.chunks=[],this.state="idle",this.options=t,this.headers=this.options.headers||{},this.hostname=this.options.hostname||h.hostname||"",this.keepAlive=this.options.keepAlive||0,this.method=this.options.method||"POST",this.parser=this.options.parser||"json",this.path=this.options.path||"",this.port=this.options.port||!this.options.hostname&&h.port||null,this.protocol=this.options.protocol||!this.options.hostname&&h.protocol||"http:",this.url=d.toURL({protocol:this.protocol,hostname:this.hostname,port:this.port,pathname:this.pathname,search:this.search}),this._handleDownload=this._handleDownload.bind(this),this._handleEnd=this._handleEnd.bind(this,e),this._handleError=this._handleError.bind(this,e),this._handlePipe=this._handlePipe.bind(this),this._handleResponse=this._handleResponse.bind(this,e),this._handleUpload=this._handleUpload.bind(this)}},getHeader(t){return d.assertArgument(d.isString(t,!0),1,"string"),this.headers[t]},setHeader(t,e){d.assertArgument(d.isString(t,!0),1,"string"),d.assertArgument(d.isVoid(e)||d.isFalse(e)||d.isInput(e),2,"string"),"idle"===this.state&&(d.isInput(e,!0)?this.headers[t]=e.toString():delete this.headers[t])},abort:{promise:!0,value(t){!this.tsAbort&&this.tsSubmit?(this.adaptee.abort(),this.state="aborted",this.tsAbort=Date.now(),t(null,!0)):t(null,!1)}},submit:{promise:!0,value(t,e,s){if(d.isInstance(t,r?n.Readable:i.File))if(d.isVoid(e)||d.isInt(e,!0)){if(!this.tsSubmit){if(this.ready(s),this.upTotal=r?null:t.size,this.upLoaded=r?0:e||0,r){let e=this.adaptee=(this.protocol.startsWith("https")?a:r).request({hostname:this.hostname,keepAlive:this.keepAlive>0,keepAliveMsecs:this.keepAlive,method:this.method,path:this.path,port:this.port,protocol:this.protocol,withCredentials:!1});Object.keys(this.headers).forEach(t=>d.isInput(this.headers[t],!0)&&e.setHeader(t,this.headers[t])),e.setHeader("Content-Type",t.headers["content-type"]||"application/octet-stream"),e.setHeader("Content-Range",t.headers["content-range"]),e.once("error",this._handleError),e.on("pipe",this._handlePipe),e.once("response",this._handleResponse)}if(!r){let e=this.adaptee=new XMLHttpRequest;e.open(this.method,this.url,!0),Object.keys(this.headers).forEach(t=>d.isInput(this.headers[t],!0)&&e.setRequestHeader(t,this.headers[t])),e.setRequestHeader("Content-Type",t.type||"application/octet-stream"),e.setRequestHeader("Content-Range",`bytes ${this.upLoaded}-${t.size-1}/${t.size}`),e.addEventListener("progress",this._handleResponse),e.addEventListener("progress",this._handleDownload),e.addEventListener("load",this._handleResponse),e.addEventListener("load",this._handleEnd),e.addEventListener("error",this._handleError),e.upload.addEventListener("progress",this._handleUpload),e.upload.addEventListener("error",this._handleError)}this.state="pending",this.tsSubmit=Date.now(),r?t.pipe(this.adaptee):this.adaptee.send(t),this.emit("submit",t)}}else s(new d.ValidationError("offset","number"));else s(new d.ValidationError("data",r?"Readable":"File"))}},adaptee:{set(t){return this.adaptee||t},validate:t=>!d.isObject(t)&&"Object"},chunks:{set(t){return this.chunks||t},validate:t=>!d.isArray(t)&&"Array"},data:{set(t){return d.isDefined(this.data)?this.data:t}},downLoaded:{set:t=>t,validate:t=>!d.isInt(t,!0)&&"number"},downRatio:{get(){return d.isVoid(this.downTotal)?null:this.downTotal?this.downLoaded/this.downTotal:1}},downTotal:{set(t){return d.isDefined(this.downTotal)?this.downTotal:t},validate:t=>!d.isNull(t)&&!d.isInt(t,!0)&&"number"},error:{set(t){return d.isDefined(this.error)?this.error:t},validate:t=>!d.isNull(t)&&!d.isObject(t)&&"Object"},headers:{set(t){return this.headers||d.isObject(t)&&d.cloneDeep(t)},validate:t=>!d.isObject(t)&&"Object"},host:{get(){return`${this.hostname||""}${this.port?`:${this.port}`:""}`}},hostname:{set(t){return this.hostname||t},validate:t=>!d.isString(t,!0)&&"string"},keepAlive:{set(t){return d.isDefined(this.keepAlive)?this.keepAlive:t},validate:t=>!d.isInt(t,!0)&&"number"},method:{set(t){return this.method||d.upperCase(t)},validate:t=>!d.isString(t,!0)&&"string"},parser:{set(t){return this.parser||t},validate(t){return!this.parsers.includes(t)&&"string"}},parsers:{frozen:!0,writable:!1,value:["buffer","json","text"]},path:{set(t){return d.isDefined(this.path)?this.path:t},then(t){let e=t.match(/([^?]*)(.*)/);this.pathname=e[1],this.query=e[2].slice(1)},validate:t=>!d.isString(t)&&"string"},pathname:{set(t){return d.isDefined(this.pathname)?this.pathname:t},validate:t=>!d.isString(t)&&"string"},port:{set(t){return d.isDefined(this.port)?this.port:t},validate:t=>!d.isNull(t)&&!d.isNumeric(t,!0)&&"number"},protocol:{set(t){return this.protocol||t},validate:t=>!d.isString(t,!0)&&"string"},query:{set(t){return d.isDefined(this.query)?this.query:t},validate:t=>!d.isString(t)&&"string"},response:{set(t){return this.response||t},validate:t=>!d.isObject(t)&&"Object"},search:{get(){return this.query?`?${this.query}`:""}},state:{set:t=>t,then(t){return"idle"!==t&&this.emit("state",t)},validate(t){return!this.states.includes(t)&&"string"}},states:{frozen:!0,writable:!1,value:["aborted","complete","failed","idle","pending"]},statusCode:{set(t){return this.statusCode||t},validate:t=>!d.isInt(t,!0)&&"number"},statusMessage:{set(t){return d.isDefined(this.statusMessage)?this.statusMessage:t},validate:t=>!d.isNull(t)&&!d.isString(t)&&"string"},time:{get(){return this.tsData?this.tsData-this.tsSubmit:void 0}},tsAbort:{set(t){return this.tsAbort||t},validate:t=>!d.isInt(t,!0)&&"number"},tsData:{set(t){return this.tsData||t},validate:t=>!d.isInt(t,!0)&&"number"},tsResponse:{set(t){return this.tsResponse||t},validate:t=>!d.isInt(t,!0)&&"number"},tsSubmit:{set(t){return this.tsSubmit||t},validate:t=>!d.isInt(t,!0)&&"number"},upLoaded:{set:t=>t,validate:t=>!d.isInt(t,!0)&&"number"},upRatio:{get(){return d.isVoid(this.downTotal)?null:this.downTotal?this.downLoaded/this.downTotal:1}},upTotal:{set(t){return d.isDefined(this.downTotal)?this.downTotal:t},validate:t=>!d.isNull(t)&&!d.isInt(t,!0)&&"number"},url:{set(t){return this.url||t},validate:t=>!d.isString(t,!0)&&"string"},_handleDownload(t){r&&"buffer"!==this.parser&&this.chunks.push(t),this.emit("download",this.downLoaded+=r?d.byteLength(t):t.loaded,this.downTotal)},_handleEnd(t,e){let s="buffer"!==this.parser?r?this.chunks.join(""):e.target.response:null;this.data="json"===this.parser?d.toDefined(d.parseJSON(s.toString())):s,this.state=this.error?"failed":"complete",this.tsData=Date.now(),this.emit(this.error?"error":"data",this.error||this.data),"buffer"!==this.parser&&t(this.error,this.data)},_handleError(t,e){this.error=d.error(0,r?e.message:"Request not sent."),this.state="failed",this.emit("error",this.error),t(this.error,null)},_handlePipe(t){t.on("data",this._handleUpload)},_handleResponse(t,e){d.isDefined(this.statusCode)||(this.response=r?e:e.target,this.statusCode=this.response[r?"statusCode":"status"]||502,this.statusMessage=this.response[r?"statusMessage":"statusText"]||o[this.statusCode]||null,this.error=this.statusCode>=400?d.error(this.statusCode,this.statusMessage):null,this.downTotal=d.toDefined(d.toFinite(r?this.response.headers["content-length"]:this.response.getResponseHeader("Content-Length"))),this.tsResponse=Date.now(),r&&this.response.on("data",this._handleDownload),r&&this.response.once("end",this._handleEnd),this.emit("response",this.response),"buffer"===this.parser&&t(this.error,this.error?null:this.response))},_handleUpload(t){this.emit("upload",this.upLoaded+=r?d.byteLength(t):t.loaded,this.upTotal)}}),"undefined"!=typeof window&&(window.XPUploader=t.exports)}).call(e,s(2))},function(t,e){var s;s=function(){return this}();try{s=s||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(s=window)}t.exports=s},function(t,e){t.exports=stream},function(t,e){t.exports=http},function(t,e){t.exports=https},function(t,e){t.exports=XP},function(t,e){t.exports=XPBuffer},function(t,e){t.exports=XPEmitter}]);